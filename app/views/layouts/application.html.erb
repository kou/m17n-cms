<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<% lang = I18n.locale -%>
<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="<%= lang %>" lang="<%= lang %>">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title><%= controller.controller_name %>: <%= controller.action_name %></title>
  <%= javascript_include_tag(:defaults) %>
  <%= extjs_include_tag %>
  <%= javascript_tag("
Ext.state.Manager.setProvider(new Ext.state.CookieProvider());

var content = null;
") %>
  <%= tiny_mce_include_tag %>
  <%= stylesheet_link_tag('base') %>
</head>
<body>

<div id="header">
<h1><%= link_to("M17N CMS", root_path) %></h1>
</div>

<%= yield %>

<%= javascript_tag(<<-EOC
Ext.onReady(function() {
  var root = new Ext.tree.AsyncTreeNode({
    id: 'root',
    expanded: true,
    children: #{page_tree_data.to_json}
  });
  var tree = new Ext.tree.TreePanel({
    root: root,
    id: 'page-tree',
    rootVisible: false,
    autoScroll: true,
    region: 'west',
    split: true,
    collapsible: true,
    title: #{t('Pages').to_json},
    listeners: {
      render: function(tree_panel) {
        tree_panel.getSelectionModel().on('selectionchange',
                                          function(_tree, node) {
          // alert(node.attributes.href);
        });
      }
    },
    tbar: [
      {
         text: #{t('Admin').to_json},
         handler: function() {
           document.location = #{pages_path.to_json};
         }
      }
    ]
  });

  if (content == null) {
    if (Ext.get('content')) {
      content = {xtype: 'panel', contentEl: 'content', region: 'center'};
    } else {
      content = {xtype: 'panel', html: 'select from the left', region: 'center'};
    }
  }
  var viewport = new Ext.Viewport({
    layout: 'border',
    items: [{xtype: 'box', el: 'header', region: 'north'},
            content,
            tree]
  });
});
EOC
) %>

</body>
</html>
